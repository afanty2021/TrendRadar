# æ ¸å¿ƒåŠŸèƒ½

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [README.md](file://README.md)
- [config.yaml](file://config/config.yaml)
- [frequency_words.txt](file://config/frequency_words.txt)
- [frequency.py](file://trendradar/core/frequency.py)
- [analyzer.py](file://trendradar/core/analyzer.py)
- [manager.py](file://trendradar/storage/manager.py)
- [local.py](file://trendradar/storage/local.py)
- [remote.py](file://trendradar/storage/remote.py)
- [dispatcher.py](file://trendradar/notification/dispatcher.py)
- [server.py](file://mcp_server/server.py)
</cite>

## ç›®å½•
1. [å…¨ç½‘çƒ­ç‚¹èšåˆ](#å…¨ç½‘çƒ­ç‚¹èšåˆ)
2. [æ™ºèƒ½æ¨é€ç­–ç•¥](#æ™ºèƒ½æ¨é€ç­–ç•¥)
3. [ç²¾å‡†å†…å®¹ç­›é€‰](#ç²¾å‡†å†…å®¹ç­›é€‰)
4. [çƒ­ç‚¹è¶‹åŠ¿åˆ†æ](#çƒ­ç‚¹è¶‹åŠ¿åˆ†æ)
5. [ä¸ªæ€§åŒ–çƒ­ç‚¹ç®—æ³•](#ä¸ªæ€§åŒ–çƒ­ç‚¹ç®—æ³•)
6. [å¤šæ¸ é“å®æ—¶æ¨é€](#å¤šæ¸ é“å®æ—¶æ¨é€)
7. [çµæ´»å­˜å‚¨æ¶æ„](#çµæ´»å­˜å‚¨æ¶æ„)
8. [AIæ™ºèƒ½åˆ†æ](#aiæ™ºèƒ½åˆ†æ)

## å…¨ç½‘çƒ­ç‚¹èšåˆ

TrendRadar çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯**å…¨ç½‘çƒ­ç‚¹èšåˆ**ï¼Œå®ƒèƒ½å¤Ÿä»å¤šä¸ªä¸»æµä¿¡æ¯å¹³å°å®æ—¶æŠ“å–çƒ­æœæ¦œå•ï¼Œå°†åˆ†æ•£çš„çƒ­ç‚¹ä¿¡æ¯é›†ä¸­åˆ°ä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾ä¸­ã€‚è¯¥åŠŸèƒ½æ—¨åœ¨å¸®åŠ©ç”¨æˆ·æ‘†è„±å•ä¸€å¹³å°çš„ç®—æ³•æ¨èæŸç¼šï¼Œä¸»åŠ¨è·å–è‡ªå·±å…³å¿ƒçš„èµ„è®¯ã€‚

### æŠ€æœ¯å®ç°

è¯¥åŠŸèƒ½ä¸»è¦ç”± `trendradar/crawler/fetcher.py` æ¨¡å—å®ç°ï¼Œé€šè¿‡è°ƒç”¨ `newsnow` é¡¹ç›®çš„ API æ¥è·å–å„å¹³å°çš„å®æ—¶æ•°æ®ã€‚é¡¹ç›®é€šè¿‡åœ¨ `config.yaml` æ–‡ä»¶ä¸­é…ç½® `platforms` åˆ—è¡¨æ¥å®šä¹‰ç›‘æ§çš„å¹³å°ã€‚

```yaml
platforms:
  - id: "toutiao"
    name: "ä»Šæ—¥å¤´æ¡"
  - id: "baidu"
    name: "ç™¾åº¦çƒ­æœ"
  - id: "wallstreetcn-hot"
    name: "åå°”è¡—è§é—»"
  # ... å…¶ä»–å¹³å°
```

ç³»ç»Ÿä¼šæ ¹æ®é…ç½®ï¼Œå®šæ—¶å‘è¿™äº›å¹³å°å‘èµ·è¯·æ±‚ï¼Œè·å–å…¶å½“å‰çš„çƒ­æœåˆ—è¡¨ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€æ’åã€é“¾æ¥ç­‰ä¿¡æ¯ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ·»åŠ æ–°å¹³å°å˜å¾—éå¸¸ç®€å•ï¼Œåªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ ç›¸åº”çš„ `id` å’Œ `name` å³å¯ã€‚

### ä¸šåŠ¡ä»·å€¼

- **ä¿¡æ¯æ•´åˆ**ï¼šç”¨æˆ·æ— éœ€åœ¨å¤šä¸ªAppä¹‹é—´åˆ‡æ¢ï¼Œå³å¯åœ¨ä¸€ä¸ªåœ°æ–¹æŒæ¡å…¨ç½‘åŠ¨æ€ã€‚
- **ä¸»åŠ¨è·å–**ï¼šæ‘†è„±äº†è¢«åŠ¨æ¥å—ç®—æ³•æ¨èçš„æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£ä¸»åŠ¨é€‰æ‹©å…³æ³¨çš„é¢†åŸŸã€‚
- **æ•ˆç‡æå‡**ï¼šæå¤§åœ°èŠ‚çœäº†ç”¨æˆ·çš„æ—¶é—´å’Œç²¾åŠ›ï¼Œé¿å…äº†åœ¨æµ·é‡ä¿¡æ¯ä¸­â€œåˆ·å±â€å¯»æ‰¾æœ‰ä»·å€¼å†…å®¹çš„ä½æ•ˆè¡Œä¸ºã€‚

**Section sources**
- [README.md](file://README.md#200)
- [config.yaml](file://config/config.yaml#164)

## æ™ºèƒ½æ¨é€ç­–ç•¥

TrendRadar æä¾›äº†ä¸‰ç§ä¸åŒçš„**æ™ºèƒ½æ¨é€æ¨¡å¼**ï¼Œä»¥æ»¡è¶³ä¸åŒç”¨æˆ·åœ¨ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚ç”¨æˆ·å¯ä»¥åœ¨ `config.yaml` æ–‡ä»¶ä¸­é€šè¿‡ `report.mode` é…ç½®é¡¹è¿›è¡Œé€‰æ‹©ã€‚

```yaml
report:
  mode: "current" # å¯é€‰: "daily"|"incremental"|"current"
```

### ä¸‰ç§æ¨¡å¼çš„æ•°æ®æµå·®å¼‚

| æ¨é€æ¨¡å¼ | æ•°æ®æµé€»è¾‘ | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- |
| **å½“æ—¥æ±‡æ€» (daily)** | æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œæ¨é€å½“å¤©æ‰€æœ‰åŒ¹é…å…³é”®è¯çš„æ–°é—»ã€‚è¿™æ˜¯ä¸€ä¸ªç´¯ç§¯çš„è¿‡ç¨‹ï¼Œä¹‹å‰æ¨é€è¿‡çš„æ–°é—»ä¼šå†æ¬¡å‡ºç°ã€‚ | é€‚åˆéœ€è¦æ¯æ—¥å…¨é¢æ€»ç»“çš„ç”¨æˆ·ï¼Œå¦‚ä¼ä¸šç®¡ç†è€…ï¼Œå¸Œæœ›åœ¨ä¸€å¤©ç»“æŸæ—¶å›é¡¾æ‰€æœ‰é‡è¦äº‹ä»¶ã€‚ |
| **å½“å‰æ¦œå• (current)** | æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œåªæ¨é€å½“å‰æ—¶é—´ç‚¹æ­£åœ¨ä¸Šæ¦œçš„æ–°é—»ã€‚ç³»ç»Ÿä¼šä»å†å²æ•°æ®ä¸­æ‰¾å‡ºæœ€æ–°ä¸€æ‰¹æŠ“å–çš„æ–°é—»è¿›è¡Œæ¨é€ã€‚ | é€‚åˆå†…å®¹åˆ›ä½œè€…å’Œè‡ªåª’ä½“äººï¼Œéœ€è¦å®æ—¶äº†è§£â€œæ­¤åˆ»â€æœ€ç«çš„è¯é¢˜ï¼Œä»¥ä¾¿å¿«é€Ÿè·Ÿè¿›ã€‚ |
| **å¢é‡ç›‘æ§ (incremental)** | åªæœ‰å½“æœ‰**æ–°å‡ºç°**çš„ã€åŒ¹é…å…³é”®è¯çš„æ–°é—»æ—¶ï¼Œæ‰ä¼šè¿›è¡Œæ¨é€ã€‚è¿™æ˜¯å”¯ä¸€ä¸€ç§â€œé›¶é‡å¤â€çš„æ¨¡å¼ã€‚ | é€‚åˆæŠ•èµ„è€…å’Œäº¤æ˜“å‘˜ï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´è·å–æ–°ä¿¡æ¯ï¼Œé¿å…è¢«é‡å¤ä¿¡æ¯å¹²æ‰°ã€‚ |

#### å®é™…æ¨é€æ•ˆæœä¸¾ä¾‹

å‡è®¾ç›‘æ§â€œè‹¹æœâ€å…³é”®è¯ï¼Œæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼š

| æ—¶é—´ | daily æ¨¡å¼æ¨é€ | current æ¨¡å¼æ¨é€ | incremental æ¨¡å¼æ¨é€ |
| :--- | :--- | :--- | :--- |
| 10:00 | æ–°é—»Aã€æ–°é—»B | æ–°é—»Aã€æ–°é—»B | æ–°é—»Aã€æ–°é—»B |
| 11:00 | æ–°é—»Aã€æ–°é—»Bã€æ–°é—»C | æ–°é—»Bã€æ–°é—»Cã€æ–°é—»D | **ä»…**æ–°é—»C |
| 12:00 | æ–°é—»Aã€æ–°é—»Bã€æ–°é—»C | æ–°é—»Cã€æ–°é—»Dã€æ–°é—»E | **ä»…**æ–°é—»Dã€æ–°é—»E |

**è¯´æ˜**ï¼š
- `daily`ï¼šç´¯ç§¯å±•ç¤ºå½“å¤©æ‰€æœ‰æ–°é—»ï¼ˆAã€Bã€C éƒ½ä¿ç•™ï¼‰
- `current`ï¼šå±•ç¤ºå½“å‰æ¦œå•çš„æ–°é—»ï¼ˆæ’åå˜åŒ–ï¼Œæ–°é—»Dä¸Šæ¦œï¼Œæ–°é—»Aæ‰æ¦œï¼‰
- `incremental`ï¼š**åªæ¨é€æ–°å‡ºç°çš„æ–°é—»**ï¼ˆé¿å…é‡å¤å¹²æ‰°ï¼‰

### ä¸šåŠ¡ä»·å€¼

- **åœºæ™¯åŒ–é€‚é…**ï¼šä¸‰ç§æ¨¡å¼è¦†ç›–äº†ä»â€œå…¨é¢å›é¡¾â€åˆ°â€œå®æ—¶è¿½è¸ªâ€å†åˆ°â€œç²¾å‡†é¢„è­¦â€çš„å®Œæ•´éœ€æ±‚é“¾æ¡ã€‚
- **å‡å°‘ä¿¡æ¯è¿‡è½½**ï¼šç‰¹åˆ«æ˜¯ `incremental` æ¨¡å¼ï¼Œèƒ½æœ‰æ•ˆé¿å…ä¿¡æ¯é‡å¤ï¼Œè®©ç”¨æˆ·åªå…³æ³¨çœŸæ­£â€œæ–°â€çš„å†…å®¹ã€‚
- **æå‡å†³ç­–æ•ˆç‡**ï¼šä¸åŒçš„æ¨¡å¼ä¸ºä¸åŒè§’è‰²çš„ç”¨æˆ·æä¾›äº†æœ€é€‚åˆçš„ä¿¡æ¯è·å–æ–¹å¼ï¼Œä»è€Œæ”¯æŒæ›´å¿«é€Ÿçš„å†³ç­–ã€‚

**Section sources**
- [README.md](file://README.md#218)
- [config.yaml](file://config/config.yaml#76)
- [analyzer.py](file://trendradar/core/analyzer.py#155)

## ç²¾å‡†å†…å®¹ç­›é€‰

**ç²¾å‡†å†…å®¹ç­›é€‰**åŠŸèƒ½å…è®¸ç”¨æˆ·é€šè¿‡é…ç½® `config/frequency_words.txt` æ–‡ä»¶æ¥å®šä¹‰è‡ªå·±å…³å¿ƒçš„å…³é”®è¯ï¼Œä»è€Œè¿‡æ»¤æ‰æ— å…³ä¿¡æ¯ï¼Œåªæ¥æ”¶é«˜åº¦ç›¸å…³çš„çƒ­ç‚¹æ¨é€ã€‚

### è¯­æ³•è¯¦è§£

`frequency_words.txt` æ–‡ä»¶ä½¿ç”¨ä¸€å¥—ç®€æ´çš„è¯­æ³•æ¥å®šä¹‰ç­›é€‰è§„åˆ™ï¼Œä¸åŒè§„åˆ™ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ã€‚

```txt
èƒ–ä¸œæ¥
äºä¸œæ¥

DeepSeek
æ¢æ–‡é”‹

åä¸º
é¸¿è’™
HarmonyOS
ä»»æ­£é

æ¯”äºšè¿ª
ç‹ä¼ ç¦

!è½¦
!é¤

[GLOBAL_FILTER]
å¹¿å‘Š
æ¨å¹¿
```

#### è¯­æ³•è§£æ

1.  **æ™®é€šè¯**ï¼šç›´æ¥å†™å…¥çš„è¯ï¼Œå¦‚ `åä¸º`ã€‚åªè¦æ ‡é¢˜ä¸­åŒ…å«ä»»æ„ä¸€ä¸ªæ™®é€šè¯ï¼Œå³è§†ä¸ºåŒ¹é…ã€‚
2.  **å¿…é¡»è¯ (+)**ï¼šä»¥ `+` å¼€å¤´çš„è¯ï¼Œå¦‚ `+AI`ã€‚æ ‡é¢˜å¿…é¡»åŒæ—¶åŒ…å«è¯¥è¯å’Œè‡³å°‘ä¸€ä¸ªæ™®é€šè¯æ‰èƒ½åŒ¹é…ã€‚è¿™ç”¨äºé™å®šèŒƒå›´ï¼Œä¾‹å¦‚ï¼Œåªæƒ³çœ‹ä¸â€œAIâ€ç›¸å…³çš„â€œç§‘æŠ€â€æ–°é—»ã€‚
3.  **è¿‡æ»¤è¯ (!)**ï¼šä»¥ `!` å¼€å¤´çš„è¯ï¼Œå¦‚ `!è½¦`ã€‚å¦‚æœæ ‡é¢˜ä¸­åŒ…å«è¯¥è¯ï¼Œåˆ™ä¼šè¢«ç›´æ¥æ’é™¤ï¼Œå³ä½¿å®ƒåŒ¹é…äº†å…¶ä»–å…³é”®è¯ã€‚
4.  **æ•°é‡é™åˆ¶ (@)**ï¼šä»¥ `@` å¼€å¤´çš„æ•°å­—ï¼Œå¦‚ `@5`ã€‚ç”¨äºé™åˆ¶è¯¥è¯ç»„æœ€å¤šæ˜¾ç¤ºçš„æ¡æ•°ã€‚
5.  **å…¨å±€è¿‡æ»¤ ([GLOBAL_FILTER])**ï¼šåœ¨ `[GLOBAL_FILTER]` åŒºåŸŸå†…å®šä¹‰çš„è¯ï¼Œä¼šåº”ç”¨äºæ‰€æœ‰è¯ç»„ã€‚ä»»ä½•åŒ…å«è¿™äº›è¯çš„æ ‡é¢˜éƒ½ä¼šè¢«è¿‡æ»¤ã€‚

### ä»£ç ä¸­çš„è§£æé€»è¾‘

`trendradar/core/frequency.py` æ–‡ä»¶ä¸­çš„ `load_frequency_words` å‡½æ•°è´Ÿè´£è§£æè¯¥æ–‡ä»¶ã€‚

```python
def load_frequency_words(frequency_file: Optional[str] = None) -> Tuple[List[Dict], List[str], List[str]]:
    # ... è¯»å–æ–‡ä»¶å†…å®¹ ...
    word_groups = [group.strip() for group in content.split("\n\n") if group.strip()]
    processed_groups = []
    filter_words = []
    global_filters = []

    current_section = "WORD_GROUPS"
    for group in word_groups:
        lines = [line.strip() for line in group.split("\n") if line.strip()]
        if not lines:
            continue

        # å¤„ç†åŒºåŸŸæ ‡è®°
        if lines[0].startswith("[") and lines[0].endswith("]"):
            section_name = lines[0][1:-1].upper()
            if section_name in ("GLOBAL_FILTER", "WORD_GROUPS"):
                current_section = section_name
            lines = lines[1:]

        # å¤„ç†å…¨å±€è¿‡æ»¤åŒº
        if current_section == "GLOBAL_FILTER":
            for line in lines:
                if line.startswith(("!", "+", "@")):
                    continue
                if line:
                    global_filters.append(line)
            continue

        # å¤„ç†è¯ç»„åŒº
        words = lines
        group_required_words = []
        group_normal_words = []
        group_filter_words = []
        group_max_count = 0

        for word in words:
            if word.startswith("@"):
                try:
                    count = int(word[1:])
                    if count > 0:
                        group_max_count = count
                except (ValueError, IndexError):
                    pass
            elif word.startswith("!"):
                filter_words.append(word[1:])
                group_filter_words.append(word[1:])
            elif word.startswith("+"):
                group_required_words.append(word[1:])
            else:
                group_normal_words.append(word)

        if group_required_words or group_normal_words:
            # ... å°†è§£æç»“æœå­˜å…¥ processed_groups ...
    return processed_groups, filter_words, global_filters
```

è¯¥å‡½æ•°å°†æ–‡ä»¶å†…å®¹è§£æä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š`processed_groups`ï¼ˆè¯ç»„åˆ—è¡¨ï¼‰ã€`filter_words`ï¼ˆè¯ç»„å†…è¿‡æ»¤è¯ï¼‰å’Œ `global_filters`ï¼ˆå…¨å±€è¿‡æ»¤è¯ï¼‰ã€‚éšåï¼Œ`matches_word_groups` å‡½æ•°ä¼šä½¿ç”¨è¿™äº›è§„åˆ™æ¥åˆ¤æ–­ä¸€æ¡æ–°é—»æ ‡é¢˜æ˜¯å¦åº”è¯¥è¢«æ¨é€ã€‚

### ä¸šåŠ¡ä»·å€¼

- **ä¸ªæ€§åŒ–å®šåˆ¶**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£ï¼ˆå¦‚æŠ•èµ„ã€ç§‘æŠ€ã€å¨±ä¹ï¼‰å®šåˆ¶ä¸“å±çš„çƒ­ç‚¹æµã€‚
- **ä¿¡æ¯é™å™ª**ï¼šæœ‰æ•ˆè¿‡æ»¤æ‰å¹¿å‘Šã€ä½è´¨å†…å®¹å’Œä¸ç›¸å…³çš„è¯é¢˜ï¼Œè®©ä¿¡æ¯æµæ›´åŠ çº¯å‡€ã€‚
- **æé«˜ä¿¡æ¯å¯†åº¦**ï¼šç¡®ä¿æ¯ä¸€æ¡æ¨é€éƒ½æ˜¯ç”¨æˆ·çœŸæ­£å…³å¿ƒçš„å†…å®¹ï¼Œæå¤§åœ°æå‡äº†ä¿¡æ¯è·å–çš„æ•ˆç‡ã€‚

**Section sources**
- [frequency.py](file://trendradar/core/frequency.py#18)
- [frequency_words.txt](file://config/frequency_words.txt#1)

## çƒ­ç‚¹è¶‹åŠ¿åˆ†æ

TrendRadar ä¸ä»…å‘Šè¯‰ç”¨æˆ·â€œä»€ä¹ˆåœ¨çƒ­æœâ€ï¼Œæ›´é€šè¿‡**çƒ­ç‚¹è¶‹åŠ¿åˆ†æ**åŠŸèƒ½æ­ç¤ºâ€œçƒ­ç‚¹å¦‚ä½•æ¼”å˜â€ã€‚å®ƒä¸ºæ¯æ¡æ–°é—»æä¾›äº†ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

### æŠ€æœ¯å®ç°

è¯¥åŠŸèƒ½çš„æ ¸å¿ƒæ˜¯æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨å’Œæ—¶é—´åºåˆ—åˆ†æã€‚ç³»ç»Ÿä¼šè®°å½•æ¯æ¡æ–°é—»çš„ä»¥ä¸‹ä¿¡æ¯ï¼š
- **é¦–æ¬¡å‡ºç°æ—¶é—´ (`first_time`)**ï¼šè¯¥æ–°é—»ç¬¬ä¸€æ¬¡è¢«ç³»ç»ŸæŠ“å–åˆ°çš„æ—¶é—´ã€‚
- **æœ€åå‡ºç°æ—¶é—´ (`last_time`)**ï¼šè¯¥æ–°é—»æœ€åä¸€æ¬¡å‡ºç°åœ¨æ¦œå•ä¸Šçš„æ—¶é—´ã€‚
- **å‡ºç°é¢‘æ¬¡ (`count`)**ï¼šè¯¥æ–°é—»åœ¨ä¸€å¤©å†…è¢«ç›‘æµ‹åˆ°çš„æ€»æ¬¡æ•°ã€‚
- **æ’åå˜åŒ– (`ranks`)**ï¼šè¯¥æ–°é—»åœ¨ä¸åŒæ—¶é—´ç‚¹çš„æ’åå†å²ã€‚

è¿™äº›æ•°æ®è¢«å­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­ï¼Œ`trendradar/core/analyzer.py` ä¸­çš„ `count_word_frequency` å‡½æ•°åˆ©ç”¨è¿™äº›æ•°æ®æ¥ç”Ÿæˆè¶‹åŠ¿åˆ†ææŠ¥å‘Šã€‚

```python
def count_word_frequency(
    results: Dict,
    word_groups: List[Dict],
    # ... å…¶ä»–å‚æ•° ...
    title_info: Optional[Dict] = None,
    # ...
):
    # ... å¤„ç†æ•°æ® ...
    for source_id, titles_data in results_to_process.items():
        for title, title_data in titles_data.items():
            # ä»å†å²ç»Ÿè®¡ä¿¡æ¯ä¸­è·å–å®Œæ•´æ•°æ®
            if (
                mode == "current"
                and title_info
                and source_id in title_info
                and title in title_info[source_id]
            ):
                info = title_info[source_id][title]
                first_time = info.get("first_time", "")
                last_time = info.get("last_time", "")
                count_info = info.get("count", 1)
                if "ranks" in info and info["ranks"]:
                    ranks = info["ranks"]
```

### åˆ†æç»´åº¦

- **æ—¶é—´è½´è¿½è¸ª**ï¼šé€šè¿‡ `é¦–æ¬¡å‡ºç°` å’Œ `æœ€åå‡ºç°` æ—¶é—´ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ä¸€æ¡æ–°é—»çš„ç”Ÿå‘½å‘¨æœŸã€‚
- **çƒ­åº¦å˜åŒ–**ï¼šé€šè¿‡ `å‡ºç°é¢‘æ¬¡` å’Œ `æ’åå˜åŒ–`ï¼Œå¯ä»¥åˆ¤æ–­ä¸€ä¸ªè¯é¢˜æ˜¯çƒ­åº¦æŒç»­ä¸Šå‡è¿˜æ˜¯é€æ¸è¡°é€€ã€‚
- **æ–°å¢æ£€æµ‹**ï¼šç³»ç»Ÿä¼šç”¨ `ğŸ†•` æ ‡è®°æ–°å‡ºç°çš„çƒ­ç‚¹ï¼Œå¸®åŠ©ç”¨æˆ·ç¬¬ä¸€æ—¶é—´å‘ç°æ–°åŠ¨æ€ã€‚
- **æŒç»­æ€§åˆ†æ**ï¼šåŒºåˆ†â€œæ˜™èŠ±ä¸€ç°â€çš„çŸ­æœŸçƒ­ç‚¹å’Œâ€œæŒç»­å‘é…µâ€çš„æ·±åº¦æ–°é—»ã€‚

### ä¸šåŠ¡ä»·å€¼

- **æ·±åº¦æ´å¯Ÿ**ï¼šå¸®åŠ©ç”¨æˆ·ç†è§£çƒ­ç‚¹äº‹ä»¶çš„èƒŒæ™¯å’Œå‘å±•è„‰ç»œï¼Œè€Œä¸ä»…ä»…æ˜¯æ ‡é¢˜å…šã€‚
- **é¢„æµ‹æœªæ¥**ï¼šé€šè¿‡åˆ†æçƒ­åº¦å˜åŒ–è¶‹åŠ¿ï¼Œå¯ä»¥é¢„æµ‹æŸä¸ªè¯é¢˜æ˜¯å¦ä¼šæˆä¸ºé•¿æœŸçƒ­ç‚¹ã€‚
- **é¿å…ç›²ä»**ï¼šäº†è§£ä¸€ä¸ªè¯é¢˜æ˜¯â€œçªç„¶çˆ†ç«â€è¿˜æ˜¯â€œæŒç»­å‡æ¸©â€ï¼Œæœ‰åŠ©äºç”¨æˆ·åšå‡ºæ›´ç†æ€§çš„åˆ¤æ–­ã€‚

**Section sources**
- [analyzer.py](file://trendradar/core/analyzer.py#90)
- [README.md](file://README.md#268)

## ä¸ªæ€§åŒ–çƒ­ç‚¹ç®—æ³•

TrendRadar çš„**ä¸ªæ€§åŒ–çƒ­ç‚¹ç®—æ³•**æ—¨åœ¨æ‰“ç ´å„å¹³å°çš„æ’åç®—æ³•ï¼Œä¸ºç”¨æˆ·é‡æ–°è®¡ç®—ä¸€ä¸ªæ›´ç¬¦åˆå…¶éœ€æ±‚çš„â€œç»¼åˆçƒ­åº¦â€æ’åã€‚

### ç®—æ³•åŸç†

è¯¥ç®—æ³•é€šè¿‡ä¸€ä¸ªåŠ æƒå…¬å¼æ¥è®¡ç®—æ¯æ¡æ–°é—»çš„ç»¼åˆæƒé‡ï¼Œå…¬å¼å¦‚ä¸‹ï¼š

`ç»¼åˆæƒé‡ = æ’åæƒé‡ Ã— 0.6 + é¢‘æ¬¡æƒé‡ Ã— 0.3 + çƒ­åº¦æƒé‡ Ã— 0.1`

è¿™ä¸ªå…¬å¼åœ¨ `trendradar/core/analyzer.py` çš„ `calculate_news_weight` å‡½æ•°ä¸­å®ç°ã€‚

```python
def calculate_news_weight(
    title_data: Dict,
    rank_threshold: int,
    weight_config: Dict,
) -> float:
    ranks = title_data.get("ranks", [])
    count = title_data.get("count", len(ranks))

    # 1. æ’åæƒé‡ï¼šÎ£(11 - min(rank, 10)) / å‡ºç°æ¬¡æ•°
    rank_scores = [11 - min(rank, 10) for rank in ranks]
    rank_weight = sum(rank_scores) / len(ranks) if ranks else 0

    # 2. é¢‘æ¬¡æƒé‡ï¼šmin(å‡ºç°æ¬¡æ•°, 10) Ã— 10
    frequency_weight = min(count, 10) * 10

    # 3. çƒ­åº¦åŠ æˆï¼šé«˜æ’åæ¬¡æ•° / æ€»å‡ºç°æ¬¡æ•° Ã— 100
    high_rank_count = sum(1 for rank in ranks if rank <= rank_threshold)
    hotness_ratio = high_rank_count / len(ranks) if ranks else 0
    hotness_weight = hotness_ratio * 100

    total_weight = (
        rank_weight * weight_config["RANK_WEIGHT"]
        + frequency_weight * weight_config["FREQUENCY_WEIGHT"]
        + hotness_weight * weight_config["HOTNESS_WEIGHT"]
    )
    return total_weight
```

### é…ç½®é¡¹è¯´æ˜

æƒé‡é…ç½®åœ¨ `config.yaml` æ–‡ä»¶ä¸­å®šä¹‰ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„åå¥½è¿›è¡Œè°ƒæ•´ã€‚

```yaml
weight:
  rank_weight: 0.6 # æ’åæƒé‡
  frequency_weight: 0.3 # é¢‘æ¬¡æƒé‡
  hotness_weight: 0.1 # çƒ­åº¦æƒé‡
```

- **rank_weight (æ’åæƒé‡)**ï¼šå æ¯”æœ€é«˜ï¼ˆ60%ï¼‰ï¼Œæ„å‘³ç€å„å¹³å°æ’åé å‰çš„æ–°é—»ä¼šè·å¾—æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚è¿™ç¡®ä¿äº†â€œé‡è¦æ–°é—»â€ä¸ä¼šè¢«é—æ¼ã€‚
- **frequency_weight (é¢‘æ¬¡æƒé‡)**ï¼šå æ¯”30%ï¼Œå…³æ³¨ä¸€ä¸ªè¯é¢˜åå¤å‡ºç°çš„é¢‘ç‡ã€‚è¿™ä½“ç°äº†è¯é¢˜çš„â€œæŒç»­æ€§â€å’Œâ€œè®¨è®ºçƒ­åº¦â€ã€‚
- **hotness_weight (çƒ­åº¦æƒé‡)**ï¼šå æ¯”10%ï¼Œè¡¡é‡ä¸€ä¸ªè¯é¢˜æ˜¯å¦ç»å¸¸æ’åœ¨å‰åˆ—ã€‚è¿™å¯ä»¥è¯†åˆ«å‡ºé‚£äº›â€œè´¨é‡é«˜â€çš„çƒ­ç‚¹ã€‚

### ä¸šåŠ¡ä»·å€¼

- **è‡ªä¸»å¯æ§**ï¼šç”¨æˆ·ä¸å†è¢«å¹³å°çš„ç®—æ³•ç‰µç€èµ°ï¼Œè€Œæ˜¯æ‹¥æœ‰ä¸€ä¸ªæ ¹æ®è‡ªå·±æƒé‡å®šä¹‰çš„â€œä¸ªäººçƒ­æœæ¦œâ€ã€‚
- **ä¿¡æ¯è´¨é‡æ›´é«˜**ï¼šé€šè¿‡ç»¼åˆè€ƒé‡æ’åã€é¢‘æ¬¡å’Œè´¨é‡ï¼Œç­›é€‰å‡ºçš„ä¿¡æ¯æ›´å…·ä»·å€¼ã€‚
- **çµæ´»è°ƒæ•´**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼ˆå¦‚æ›´å…³æ³¨çªå‘æ–°é—»æˆ–æŒç»­çƒ­ç‚¹ï¼‰æ¥è°ƒæ•´æƒé‡ï¼Œå®ç°çœŸæ­£çš„ä¸ªæ€§åŒ–ã€‚

**Section sources**
- [analyzer.py](file://trendradar/core/analyzer.py#16)
- [config.yaml](file://config/config.yaml#158)

## å¤šæ¸ é“å®æ—¶æ¨é€

TrendRadar æ”¯æŒå°†çƒ­ç‚¹ä¿¡æ¯é€šè¿‡å¤šç§æ¸ é“å®æ—¶æ¨é€åˆ°ç”¨æˆ·çš„è®¾å¤‡ä¸Šï¼Œç¡®ä¿ç”¨æˆ·ä¸ä¼šé”™è¿‡ä»»ä½•é‡è¦èµ„è®¯ã€‚

### æŠ€æœ¯å®ç°

æ¨é€åŠŸèƒ½ç”± `trendradar/notification` ç›®å½•ä¸‹çš„æ¨¡å—å®ç°ã€‚`dispatcher.py` æ˜¯æ ¸å¿ƒçš„è°ƒåº¦å™¨ï¼Œå®ƒæ ¹æ® `config.yaml` ä¸­çš„ Webhook é…ç½®ï¼Œå°†ç”Ÿæˆçš„æŠ¥å‘Šåˆ†å‘åˆ°å„ä¸ªæ¸ é“ã€‚

```python
class NotificationDispatcher:
    def dispatch_all(
        self,
        report_data: Dict,
        report_type: str,
        # ... å…¶ä»–å‚æ•° ...
    ) -> Dict[str, bool]:
        results = {}
        # é£ä¹¦
        if self.config.get("FEISHU_WEBHOOK_URL"):
            results["feishu"] = self._send_feishu(report_data, report_type, ...)

        # ä¼ä¸šå¾®ä¿¡
        if self.config.get("WEWORK_WEBHOOK_URL"):
            results["wework"] = self._send_wework(report_data, report_type, ...)

        # Telegram
        if self.config.get("TELEGRAM_BOT_TOKEN") and self.config.get("TELEGRAM_CHAT_ID"):
            results["telegram"] = self._send_telegram(report_data, report_type, ...)
        # ... å…¶ä»–æ¸ é“
        return results
```

### å¤šè´¦å·æ”¯æŒ

ä» v3.5.0 ç‰ˆæœ¬å¼€å§‹ï¼Œæ‰€æœ‰æ¨é€æ¸ é“å‡æ”¯æŒé…ç½®å¤šä¸ªè´¦å·ã€‚ç”¨æˆ·åªéœ€ä½¿ç”¨è‹±æ–‡åˆ†å· `;` åˆ†éš”å¤šä¸ª Webhook URL æˆ– Token å³å¯ã€‚

```yaml
notification:
  webhooks:
    feishu_url: "https://webhook1;https://webhook2"
    telegram_bot_token: "token1;token2"
    telegram_chat_id: "id1;id2"
```

`dispatcher.py` ä¸­çš„ `_send_to_multi_accounts` æ–¹æ³•ä¼šè‡ªåŠ¨å¤„ç†å¤šè´¦å·çš„å‘é€é€»è¾‘ã€‚

### ä¸šåŠ¡ä»·å€¼

- **è§¦è¾¾å¹¿æ³›**ï¼šæ”¯æŒä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ã€é’‰é’‰ã€Telegramã€é‚®ä»¶ç­‰ä¸»æµæ¸ é“ï¼Œæ»¡è¶³ä¸åŒç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ã€‚
- **é«˜å¯é æ€§**ï¼šå¤šè´¦å·æ”¯æŒæä¾›äº†å†—ä½™ï¼Œå³ä½¿ä¸€ä¸ªæ¸ é“å¤±æ•ˆï¼Œä¿¡æ¯ä¹Ÿèƒ½é€šè¿‡å…¶ä»–æ¸ é“é€è¾¾ã€‚
- **çµæ´»é€šçŸ¥**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®åœºæ™¯é€‰æ‹©ä¸åŒçš„æ¨é€æ–¹å¼ï¼Œå¦‚å·¥ä½œä¿¡æ¯æ¨é€åˆ°é£ä¹¦ï¼Œä¸ªäººèµ„è®¯æ¨é€åˆ°å¾®ä¿¡ã€‚

**Section sources**
- [dispatcher.py](file://trendradar/notification/dispatcher.py#34)
- [config.yaml](file://config/config.yaml#140)

## çµæ´»å­˜å‚¨æ¶æ„

TrendRadar çš„**çµæ´»å­˜å‚¨æ¶æ„**æ˜¯å…¶ v4.0.0 ç‰ˆæœ¬çš„é‡å¤§æ›´æ–°ï¼Œå®ƒæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼Œé€‚åº”ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒã€‚

### æŠ€æœ¯å®ç°

è¯¥åŠŸèƒ½ç”± `trendradar/storage/manager.py` ç»Ÿä¸€ç®¡ç†ã€‚ç³»ç»Ÿä¼šæ ¹æ®è¿è¡Œç¯å¢ƒå’Œé…ç½®è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å­˜å‚¨åç«¯ã€‚

```python
class StorageManager:
    def _resolve_backend_type(self) -> str:
        """è§£æå®é™…ä½¿ç”¨çš„åç«¯ç±»å‹"""
        if self.backend_type == "auto":
            if self.is_github_actions():
                if self._has_remote_config():
                    return "remote"
                else:
                    return "local"
            else:
                return "local"
        return self.backend_type

    def get_backend(self) -> StorageBackend:
        """è·å–å­˜å‚¨åç«¯å®ä¾‹"""
        resolved_type = self._resolve_backend_type()
        if resolved_type == "remote":
            self._backend = self._create_remote_backend()
        else:
            from trendradar.storage.local import LocalStorageBackend
            self._backend = LocalStorageBackend(...)
        return self._backend
```

#### å­˜å‚¨åç«¯

1.  **æœ¬åœ° SQLite æ•°æ®åº“ (local)**ï¼š
    *   **æŠ€æœ¯**ï¼šä½¿ç”¨ `trendradar/storage/local.py` æ¨¡å—ï¼Œå°†æ•°æ®å­˜å‚¨åœ¨ `output` ç›®å½•ä¸‹çš„ SQLite æ–‡ä»¶ä¸­ã€‚
    *   **é€‚ç”¨**ï¼šDocker éƒ¨ç½²æˆ–æœ¬åœ°è¿è¡Œï¼Œæ•°æ®å®Œå…¨è‡ªä¸»å¯æ§ã€‚
2.  **è¿œç¨‹äº‘å­˜å‚¨ (remote)**ï¼š
    *   **æŠ€æœ¯**ï¼šä½¿ç”¨ `trendradar/storage/remote.py` æ¨¡å—ï¼Œé€šè¿‡ S3 å…¼å®¹åè®®ï¼ˆå¦‚ Cloudflare R2ã€é˜¿é‡Œäº‘ OSSï¼‰å°†æ•°æ®å­˜å‚¨åœ¨äº‘ç«¯ã€‚
    *   **é€‚ç”¨**ï¼šGitHub Actions éƒ¨ç½²ï¼Œé¿å…æ±¡æŸ“ä»£ç ä»“åº“ã€‚

### æ•°æ®æ ¼å¼

| æ ¼å¼ | ç”¨é€” | è¯´æ˜ |
| :--- | :--- | :--- |
| **SQLite** | ä¸»å­˜å‚¨ | ç»“æ„åŒ–æ•°æ®åº“ï¼Œæ”¯æŒé«˜æ•ˆæŸ¥è¯¢å’Œ MCP AI åˆ†æã€‚ |
| **TXT** | å¯é€‰å¿«ç…§ | çº¯æ–‡æœ¬æ ¼å¼ï¼Œæ–¹ä¾¿ç›´æ¥æŸ¥çœ‹å’Œè°ƒè¯•ã€‚ |
| **HTML** | æŠ¥å‘Šå±•ç¤º | ç²¾ç¾çš„å¯è§†åŒ–ç½‘é¡µï¼Œæ”¯æŒ GitHub Pages ç›´æ¥æµè§ˆã€‚ |

### ä¸šåŠ¡ä»·å€¼

- **éƒ¨ç½²çµæ´»**ï¼šæ— è®ºæ˜¯é€‰æ‹© Docker è¿˜æ˜¯ GitHub Actionsï¼Œéƒ½èƒ½è·å¾—æœ€ä½³çš„å­˜å‚¨ä½“éªŒã€‚
- **æ•°æ®å®‰å…¨**ï¼šæœ¬åœ°éƒ¨ç½²ä¿è¯æ•°æ®å®Œå…¨ç§æœ‰ï¼›äº‘ç«¯éƒ¨ç½²åˆ™é¿å…äº† Git ä»“åº“çš„é¢‘ç¹æäº¤ã€‚
- **æ˜“äºåˆ†æ**ï¼šSQLite æ ¼å¼ä¸º AI åˆ†æåŠŸèƒ½æä¾›äº†åšå®çš„æ•°æ®åŸºç¡€ã€‚

**Section sources**
- [manager.py](file://trendradar/storage/manager.py#18)
- [local.py](file://trendradar/storage/local.py#25)
- [remote.py](file://trendradar/storage/remote.py#53)
- [config.yaml](file://config/config.yaml#14)

## AIæ™ºèƒ½åˆ†æ

**AIæ™ºèƒ½åˆ†æ**åŠŸèƒ½åŸºäº MCP (Model Context Protocol) åè®®ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€ä¸æœ¬åœ°å­˜å‚¨çš„æ–°é—»æ•°æ®è¿›è¡Œå¯¹è¯ï¼Œå®ç°æ·±åº¦çš„æ•°æ®æŒ–æ˜ã€‚

### æŠ€æœ¯å®ç°

è¯¥åŠŸèƒ½ç”± `mcp_server` ç›®å½•ä¸‹çš„æœåŠ¡æä¾›ã€‚`mcp_server/server.py` æ˜¯ä¸»æœåŠ¡å…¥å£ï¼Œå®ƒæš´éœ²äº†ä¸€ç³»åˆ—æ ‡å‡†åŒ–çš„å·¥å…·ï¼ˆToolsï¼‰ä¾› AI å®¢æˆ·ç«¯è°ƒç”¨ã€‚

```python
# åˆ›å»º FastMCP 2.0 åº”ç”¨
mcp = FastMCP('trendradar-news')

# æ³¨å†Œå·¥å…·
@mcp.tool
async def analyze_topic_trend(
    topic: str,
    analysis_type: str = "trend",
    date_range: Optional[Dict[str, str]] = None,
    # ... å…¶ä»–å‚æ•° ...
) -> str:
    """
    ç»Ÿä¸€è¯é¢˜è¶‹åŠ¿åˆ†æå·¥å…· - æ•´åˆå¤šç§è¶‹åŠ¿åˆ†ææ¨¡å¼
    """
    tools = _get_tools()
    result = tools['analytics'].analyze_topic_trend_unified(...)
    return json.dumps(result, ensure_ascii=False, indent=2)
```

#### æ ¸å¿ƒåˆ†æå·¥å…·

1.  **`analyze_topic_trend`**ï¼šåˆ†æè¯é¢˜çš„çƒ­åº¦è¶‹åŠ¿ã€ç”Ÿå‘½å‘¨æœŸã€å¼‚å¸¸çƒ­åº¦æ£€æµ‹å’Œæœªæ¥é¢„æµ‹ã€‚
2.  **`analyze_data_insights`**ï¼šè¿›è¡Œè·¨å¹³å°å¯¹æ¯”ã€å¹³å°æ´»è·ƒåº¦ç»Ÿè®¡å’Œå…³é”®è¯å…±ç°åˆ†æã€‚
3.  **`analyze_sentiment`**ï¼šåˆ†ææ–°é—»çš„æƒ…æ„Ÿå€¾å‘ã€‚
4.  **`search_news`**ï¼šæ”¯æŒå…³é”®è¯ã€æ¨¡ç³Šå’Œå®ä½“æœç´¢ã€‚
5.  **`resolve_date_range`**ï¼šå°†â€œæœ¬å‘¨â€ã€â€œæœ€è¿‘7å¤©â€ç­‰è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºç²¾ç¡®çš„æ—¥æœŸèŒƒå›´ï¼Œç¡®ä¿åˆ†æçš„å‡†ç¡®æ€§ã€‚

### ä½¿ç”¨ç¤ºä¾‹

ç”¨æˆ·å¯ä»¥åƒè¿™æ ·ä¸ AI å¯¹è¯ï¼š
- â€œåˆ†æâ€˜äººå·¥æ™ºèƒ½â€™æœ€è¿‘ä¸€å‘¨çš„çƒ­åº¦è¶‹åŠ¿â€
- â€œå¯¹æ¯”çŸ¥ä¹å’Œå¾®åšå¯¹â€˜æ¯”ç‰¹å¸â€™çš„å…³æ³¨åº¦â€
- â€œæœç´¢â€˜ç‰¹æ–¯æ‹‰â€™ç›¸å…³æ–°é—»å¹¶åˆ†ææƒ…æ„Ÿå€¾å‘â€

AI ä¼šè‡ªåŠ¨è°ƒç”¨ `resolve_date_range` å’Œ `analyze_topic_trend` ç­‰å·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚

### ä¸šåŠ¡ä»·å€¼

- **é›¶é—¨æ§›æŸ¥è¯¢**ï¼šç”¨æˆ·æ— éœ€å­¦ä¹ å¤æ‚çš„æŸ¥è¯¢è¯­æ³•ï¼Œç”¨è‡ªç„¶è¯­è¨€å³å¯è·å–æ·±åº¦æ´å¯Ÿã€‚
- **æ·±åº¦æ•°æ®æŒ–æ˜**ï¼šè¶…è¶Šäº†ç®€å•çš„ä¿¡æ¯æ¨é€ï¼Œèƒ½å¤Ÿå›ç­”â€œä¸ºä»€ä¹ˆâ€å’Œâ€œæ€ä¹ˆæ ·â€çš„é—®é¢˜ã€‚
- **æ™ºèƒ½å†³ç­–æ”¯æŒ**ï¼šä¸ºæŠ•èµ„ã€èˆ†æƒ…ç›‘æ§ç­‰åœºæ™¯æä¾›å¼ºå¤§çš„æ•°æ®æ”¯æŒã€‚

**Section sources**
- [server.py](file://mcp_server/server.py#24)
- [README.md](file://README.md#328)
- [README-MCP-FAQ.md](file://README-MCP-FAQ.md#226)